PhonePe Data Analyst Interview Experience (0–2 Years):

1. Write a SQL query to find the top 5 users with the highest total payment amount in the last 2 months.
2. Identify merchants who received payments from more than 200 unique customers.
3. Find users who never made a failed payment.
4. Calculate the average number of transactions per user in the last 3 months. ###########
5. Retrieve users who made payments on at least 10 different days in the last month.
6. Write a query to get the most used bank for each city.
7. Find users who have at least 5 transactions above ₹10,000.
8. Write a query to get the first and latest payment date for each merchant.
9. Identify users who made at least 1 payment every week for the last 6 weeks.
10. Find merchants with total transaction amount above the average merchant transaction amount in their city.



Solutions:


1.

SELECT user_id
FROM(
SELECT user_id,
DENSE_RANK() OVER(PARTITION BY user_id ORDER BY amount DESC) AS rnk
FROM Transactions
WHERE status = 'Success'
AND txn_date BETWEEN DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 2 MONTH),'%Y-%m-01') AND LAST_DAY(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))
) AS ranked_txns
WHERE rnk <= 5;

2. 

SELECT merchant_id, COUNT(user_id) AS users_cnt
FROM Transactions
WHERE status = 'Success'
GROUP BY merchant_id
HAVING users_cnt > 200;

3. 
SELECT user_id
FROM(
SELECT user_id,
SUM(CASE WHEN status = 'failed' THEN 1 ELSE 0 END) AS failed_trans
FROM Transactions
GROUP BY user_id
HAVING failed_trans = 0) AS no_failures

4.  

SELECT
COUNT(txn_id)/COUNT(DISTINCT user_id) AS average
FROM Transactions
WHERE txn_date BETWEEN DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 3 MONTH),'%Y-%m-01') AND LAST_DAY(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))

5. 

SELECT user_id
FROM Transactions
WHERE txn_date BETWEEN DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 MONTH),'%Y-%m-01') AND LAST_DAY(DATE_SUB(CURDATE(), INTERVAL 1 MONTH))
GROUP BY 1
HAVING COUNT(DISTINCT txn_date) > 10;
